;/*FB_PKG_DELIM*/

__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","QPLUserFlow","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","qpl","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=c("qpl")._(931609794,"2369");c("QPLUserFlow").start(p);var q=d("SharedWorkerStatusLock").getStatusLock({});c("QPLUserFlow").addPoint(p,"status_lock");c("QPLUserFlow").addAnnotations(p,{string:{id:self.worker_id}});self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle",workerID:self.worker_id}})}catch(a){c("QPLUserFlow").endFailure(p,"timeout_termination_error"),x(a)}self.close()}},3e5);function r(){m=!0,n=null,h!==null&&(c("QPLUserFlow").addPoint(p,"process_message_buffer"),c("QPLUserFlow").addAnnotations(p,{"int":{message_buffer_size:i.length}}),i.forEach(function(a){return a()}),i=[]),c("QPLUserFlow").endSuccess(p)}function s(a,f){var g=a.data;if(typeof g==="object"&&(g==null?void 0:g.type)==="execute-worker"){var k=!l;try{if(!l&&g.args instanceof Array){var t=g.args[0],u=t.hsdp,v=t.jsmods,w=t.dynamicModules;t=t.rds;c("QPLUserFlow").addPoint(p,"first_init");u!=null&&d("HasteSupportData").handle(u);d("WorkerBootstrap").initDynamicModules((v=(u=v)!=null?u:w)!=null?v:{});t!=null&&t.length>0&&e.call(null,t,function(){});q.init();c("QPLUserFlow").addPoint(p,"status_lock_init");l=!0;n!=null&&(n(),r())}u=b.call(b,"SiteData");j.size>1&&f.postMessage({type:"execute-worker-imports",response:{}});f.postMessage({type:"execute-worker-ack",response:{firstInit:k,workerRevision:u.client_revision,spinMode:u.spin,spinTime:u.__spin_t}});o=!0}catch(a){c("QPLUserFlow").endFailure(p,"worker_init_error"),q.release(),f.postMessage({type:"execute-worker-ack",response:{firstInit:k,error:a.message}}),self.close()}}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-get-rev")try{w=b.call(b,"SiteData");f.postMessage({type:"sw-get-rev",response:{workerRevision:w.client_revision,spinMode:w.spin,spinTime:w.__spin_t}})}catch(a){f.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-shutdown"){v=Array.isArray(g.args)?g.args[0]:null;typeof v==="object"&&(v==null?void 0:v.upgrade)===!0?y("requested-upgrade"):typeof v==="object"&&typeof (v==null?void 0:v.reason)==="string"?y(v==null?void 0:v.reason):y()}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-uptime-tracking"){u=typeof (g==null?void 0:g.args)==="object"?(t=g.args)==null?void 0:t.trackerID:null;f.postMessage({type:"sw-uptime-tracking",response:{trackerID:u}})}else typeof g==="object"&&(g==null?void 0:g.type)==="ww-hrp-init"?f.postMessage({type:"ww-hrp-init",response:{}}):typeof g==="object"&&(g==null?void 0:g.type)==="ww-connection-ack"?f.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}):h!==null&&m?h(g):i.push(function(){return s(a,f)})}function a(a){var b=h==null;h=(a=a)!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function t(a,b){j.forEach(function(c){try{c.postMessage(a,b)}catch(b){c.postMessage(a)}})}function f(a){if(l){c("QPLUserFlow").addPoint(p,"init_complete_handler_ran");a();r();return}c("QPLUserFlow").addPoint(p,"init_complete_handler_attached");n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){t({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}t({type:"console",response:{method:a,args:e}})}});try{c("QPLUserFlow").addPoint(p,"bootstrap_start");var u=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer();if(u!=null){var v=u.ports,w=u.messages;c("QPLUserFlow").addAnnotations(p,{"int":{bootstrap_ports_num:v.length}});v==null?void 0:v.forEach(function(a){try{a.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}),a.addEventListener("message",function(b){return s(b,a)}),j.add(a)}catch(a){c("QPLUserFlow").addPoint(p,"connection_fail"),x(a)}});w==null?void 0:w.forEach(function(a){try{s(a.e,a.port)}catch(b){c("QPLUserFlow").addPoint(p,"message_processing_fail");c("QPLUserFlow").addAnnotations(p,{string:{failed_msg_type:(a=(a=a.e.data)==null?void 0:a.type)!=null?a:"unknown"}});x(b)}c("QPLUserFlow").addAnnotations(p,{"int":{msg_num:w.length},string_array:{msgs:w.map(function(a){return(a=a.e.data)==null?void 0:a.type})}})})}else c("QPLUserFlow").addPoint(p,"bootstrap_buffer_empty")}catch(a){x(a),c("QPLUserFlow").endFailure(p,"uncaught_bootstrap_error")}function x(a){try{t({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(b){c("QPLUserFlow").addPoint(p,"sending_error_failed");c("QPLUserFlow").addAnnotations(p,{string:{error:String((a=b.message)!=null?a:b)}})}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}x(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}});b.addEventListener("message",function(a){return s(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(x),k.splice(0,k.length))});function y(a){q.release(),t({type:"sw-shutdown",response:{reason:a,workerID:self.worker_id,isInitialized:o}}),self.close()}g.setMessageHandler=a;g.postMessage=t;g.onInitComplete=f;g.shutdownWorker=y}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("MAWBuildNewMsgPayload",["MAWAuthor","MAWDbMsg","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});i=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{hdType:e.hdType,type:d("MAWMsgType").MSG_TYPE.IMAGE},i);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");b=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:b,mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("err")("EditAction is not supported yet");case"BumpExistingMessage":throw c("err")("BumpExistingMessage is not supported yet");case"ReceiverFetch":throw c("err")("ReceiverFetch is not supported yet");case"GroupPollCreate":throw c("err")("GroupPollCreate is not supported yet");case"GroupPollUpdate":throw c("err")("GroupPollUpdate is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("err")("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("err")("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("err")("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("err")("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWEbUploadQueueAckUtils",["ExecutionEnvironment","MAWBridgeSafeActionsWorkerAndUI","MAWEbUploadQueue","Promise","WATagsLogger","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKey failed with error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid instanceKey provided to ackWithInstanceKey: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot ack the item from upload flow V1 when upload flow V2 is enabled"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKey failed with error ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot ack the item from upload flow V1 when upload flow V2 is enabled"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["No instance keys provided to ackWithInstanceKeyBatched"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKeyBatchedWorker failed with error ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid instanceKey provided to ackWithInstanceKeyBatchedWorker: ",""]);q=function(){return a};return a}var r=d("WATagsLogger").TAGS(["labyrinth_web","MAWEbUploadQueueUtils"]);function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.instancesWithOutcomes;if(b.length===0){r.WARN(o());return}if(c("qex")._("506")){r.WARN(n());return}if((i||(i=c("ExecutionEnvironment"))).isInWorker)try{yield t(b)}catch(a){r.ERROR(m(),a)}else d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",a)});return s.apply(this,arguments)}function t(a){return(h||(h=b("Promise"))).all(a.map(function(a){var b=a.instanceKey;a=a.success;if(Number.isNaN(b)){r.ERROR(q(),b);return}try{b=parseInt(b,10);return d("MAWEbUploadQueue").ackWithInstanceKeyWorkerOnly(b,a)}catch(a){r.ERROR(p(),a)}}))}function e(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("qex")._("506")){r.WARN(l());return}if(Number.isNaN(a)){r.ERROR(k(),a);return(h||(h=b("Promise"))).resolve()}if((i||(i=c("ExecutionEnvironment"))).isInWorker)try{return yield d("MAWEbUploadQueue").ackWithInstanceKeyWorkerOnly(a,e)}catch(a){r.ERROR(j(),a)}else d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKey",{instanceKey:a,success:e});return(h||(h=b("Promise"))).resolve()});return u.apply(this,arguments)}g.ackWithInstanceKeyBatched=a;g.ackWithInstanceKey=e}),98);
__d("MAWLoadMessagesRequest",["FBLogger","MAWMessagesCompare","MAWMessagesDirection","MessagesRangesV2ExternalIds","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){if(a.length===0)return[];e=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e));a=[].concat(a).sort(e);if(b.lowerBoundExternalId!=null&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){e=a.findIndex(function(a){return a.externalId===b.lowerBoundExternalId});e!==-1?a=a.slice(e):c("FBLogger")("messenger_e2ee_web").mustfix("Get messages for range: no external id in source msgs list")}a=i(a,b);return a.slice(0,b.numMsgs)}function a(a,b,c,e){a=a.filter(function(a){var c;return((c=a.sortOrderMs)!=null?c:Number.MAX_SAFE_INTEGER)>=b.gte[0]&&((c=a.sortOrderMs)!=null?c:Number.MIN_SAFE_INTEGER)<=b.lte[0]});var f=d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:[b.gte,b.lte],before:[b.lte,b.gte]}),g=f[0],i=g[0];g=g[1];f=f[1];f[0];var j=f[1];f=h(a,{includeLowerBoundMsg:!0,lowerBoundExternalId:d("WAStanzaUtils").toStanzaId(g),lowerBoundSortOrderMs:i,numMsgs:e},c);if(j!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&j!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){a=f.findIndex(function(a){return a.externalId===j});if(a!==-1)return f.slice(0,a)}return f}function i(a,b){if(b.includeLowerBoundMsg||a.length===0)return a;return a[0].externalId===b.lowerBoundExternalId||a[0].sortOrderMs===b.lowerBoundSortOrderMs?a.slice(1):a}g.getMsgsForRange=h;g.getMsgsForBounds=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=0,e=0,f=!1,g=null;return function(h){e++;if(g!=null&&g===h.sortOrderMs)return!1;if(e>b&&h.sortOrderMs!==a)return!0;h.msgId===c&&(f=!0);f&&d++;if(d>b)return!0;g=h.sortOrderMs;return!1}}function b(a){var b=!0,c=0,d=null;return function(e){if(d===null)c++;else if(d===e.sortOrderMs){c+=b?0:1;return!1}else c++,b=!1;if(c>a)return!0;d=e.sortOrderMs;return!1}}f.makeUntilWithRangeExtension=a;f.makeUntilWithRangeExtensionBothDirections=b}),66);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils","emptyFunction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeOutgoingMsg: "," is not identical for partial optimistic upsert: "," vs ",""]);h=function(){return a};return a}var i=function(a,b,c,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:e,instanceKey:b})};function j(a,b,c){if(b===c)return;d("WALogger").WARN(h(),a,b,c)}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,e,f,g,h,m,n){g.content!=null&&(g.content=d("MAWVault").vault(g.content));i("write_outgoing_msg_start",n,m);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),a.messages.where("externalId").equals(b).toArray(),k(a,g.quote,e),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,g.ravenProtocolMsgId,h)]).then(function(e){var k=e[0],o=e[1],p=e[2];e=e[3];i("write_outgoing_msg_data_fetched",n,m,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(h)}});if(k==null)return{type:"missing_thread"};var q=o.find(function(a){return a.threadJid===k.jid&&a.author===d("WAJids").AUTHOR_ME});if(q!=null&&q.ack!==d("MAWAckLevel").ACK.partialOptimistic)return q.ack>=d("MAWAckLevel").ACK.sent?{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"already_sent"}:{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"not_sent"};else{var r=q==null?void 0:q.rowId;q&&(j("ts",q.ts,f),j("threadJid",q.threadJid,k.jid));if(!d("MAWDbMsg").isUnrenderedMsgType(h)){o={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g.ephemeralSetting,externalId:b,isForwarded:g.isForwarded,specialTextSize:g.specialTextSize,threadJid:k.jid,ts:f};var s=d("MAWBuildNewMsgPayload").buildNewMsg(h,o,g,p),t=g.isFirstMsg,u=g.openMessageOtid,v=g.openMessageParticipantCount,w=g.optimisticMsg,x=g.participantCount;o=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,s).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,s,k,"MAWWriteOutgoingMsgApi",{isCurrentDeviceSendingMsg:!0,isFirstMsg:t,isOutgoing:!0,openMessageOtid:u,openMessageParticipantCount:v,optimisticMsg:w,participantCount:x,quotedReplyAttachmentMeta:b,s2sInstanceKey:n,upsertRowData:r!=null?{msgId:c("nullthrows")(q==null?void 0:q.msgId),rowId:r}:void 0})})}else{p={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:k.jid,ts:f};p=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(h,p,g,e==null?void 0:e.externalId);o=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,p,k)}return o.then(function(c){i("write_outgoing_msg_promise_resolved",n,m);return l(a,h,k.jid,f).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,e,f){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:f};return a.ephemeralSettings.put(b)}).then(c("emptyFunction"))}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.getQuoteInfo=k}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}g.getProtocolMsgIdByMsgIdCommon=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=(yield c("loadTaskHandlerResource")(e));if(g==null)throw c("FBLogger")("maw_worker").mustfixThrow("No task handler found in context %s",e);e=(yield g.handleTask(f,d));g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("maw_worker").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);