;/*FB_PKG_DELIM*/

__d("EBSMGatingUI",["EBSMGating","MAWWaitForBackendSetup"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWWaitForBackendSetup").isBackendSetupSuccessful()||d("EBSMGating").isPersistedEBTableEnabled()}g.isBackendSetupSuccessfulForEBSM=a}),98);
__d("MWAddDeviceTracking",["FBLogger","MAWBridgeSafeActionsWorkerAndUI","QPLUserFlow","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("trackAddingEbDevice",{deviceId:a}));c("QPLUserFlow").addAnnotations(b,{bool:{overwritten_device:a}})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on trackAddingEbDevice in UI")}});return i.apply(this,arguments)}function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(!c("gkx")("7413"))return;if(e!=null){yield h(e,b);return}yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){if((a==null?void 0:a.deviceId)!=null)return h(a==null?void 0:a.deviceId,b);else c("FBLogger")("labyrinth_web").mustfix("Error on fetching secure_encrypted_backups_client_state: empty data")})["catch"](function(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on fetching secure_encrypted_backups_client_state")})});return j.apply(this,arguments)}g.trackAddingDevice=a}),98);
__d("MWEncryptedBackupsInitializeRestoreDeferred",["MWChatEncryptedBackupsQPLEvents","QPLUserFlow","WALogger","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error initializing restore: ",""]);h=function(){return a};return a}var i=c("requireDeferred")("MWEncryptedBackupsInitializeRestore").__setRef("MWEncryptedBackupsInitializeRestoreDeferred");function a(a){var b=a.db,e=a.onFailure,f=a.onSuccess;i.onReady(function(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore_sproc"),c("promiseDone")(a.initializeRestore(b),f,function(a){d("WALogger").ERROR(h(),a),e==null?void 0:e("failed_to_initialize_restore")})})}g.encryptedBackupsInitializeRestoreDeferred=a}),98);
__d("mwEBAddDevice",["EBAPIQPLPoints","ExecutionEnvironment","FBLogger","I64","LSAddDeviceStoredProcedure","LSDataTraceCheckPoint","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","MAWBridgeFireAndForget","MAWRestoreMsgsTxns","MAWTraceUtils","MWAddDeviceTracking","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsRecoveryCodeStatus","Promise","QPLUserFlow","ReQL","WAHashStringToNumber","isInstamadilloEB","promiseDone","qpl","setTimeout","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=10;function m(a){var e=a.count,f=a.storage;return new(k||(k=b("Promise")))(function(a,b){if(e===l)return a();c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.tables.encrypted_backups)),function(b){b=b==null?void 0:b.backupId;if(b!=null)return a(b);c("setTimeout")(function(){a(m({count:e+1,storage:f}))},1e3)},function(a){return b(a)})})}function a(a){var e=a.onFailure,g=a.onInvalidRecoveryCode,l=a.onStart,n=a.onSuccess,o=a.recoveryCode,p=a.storage,q=a.traceId,r=function(){},s=!1,t=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());a=new(k||(k=b("Promise")))(function(a,b){c("setTimeout")(function(){if(s)return;var a="Add device failed by timeout 90 sec";c("FBLogger")("labyrinth_web").warn(a);e("add_device_timeout");c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT,{instanceKey:t});b(a)},9e4)});var u=new k(function(a,s){c("QPLUserFlow").start(c("qpl")._(521473756,"2768"),{annotations:{bool:{isEBAddDeviceWithKeys:!1,isInWorker:!1}},instanceKey:t}),c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ON_START_BEGIN,{data:{string:{traceId:q}},instanceKey:t}),l(),c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ON_START_SUCCESS,{data:{string:{traceId:q}},instanceKey:t}),r=p.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(b,f){if(f.operation==="delete")return;b=[f.value];c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_check_rc_status");c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS,{data:{string:{traceId:q}},instanceKey:t});d("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){var a="LSEncryptedBackupsRecoveryCodeStatus system error";d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);r();c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS,{annotations:{string:{traceId:q}},instanceKey:t});e("add_device_failed_to_get_rc_status");s(a)},onInvalidRecoveryCode:function(){var a="Invalid recovery code";d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE,{annotations:{string:{traceId:q}},instanceKey:t});r();g();s(a)},onSuccess:function(){d("MAWTraceUtils").recordSuccessAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_INITIALIZE_RESTORE),[]),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore"),c("QPLUserFlow").endSuccess(c("qpl")._(521473756,"2768"),{instanceKey:t}),r(),!c("isInstamadilloEB")()?(void ((h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWRestoreMsgsTxns").checkForDecryptionFailuresToPointRestore():d("MAWBridgeFireAndForget").fireAndForget("backend","checkForDecryptionFailuresToPointRestore")),(h||(h=c("ExecutionEnvironment"))).isInWorker||d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:p,onFailure:e,onSuccess:n})):(c("QPLUserFlow").endSuccess(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent),n()),d("MWAddDeviceTracking").trackAddingDevice(p,d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent)["finally"](function(){return a()}),a()},recoveryCodeStatusData:b})}),c("promiseDone")(m({count:0,storage:p}),function(a){if(a!=null){var g=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(g==="")return(k||(k=b("Promise"))).reject("deviceRegistrationId is not defined");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_sproc_begin");c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START,{instanceKey:t});c("promiseDone")(p.runInTransaction(function(b){return c("LSAddDeviceStoredProcedure")(c("LSFactory")(b),{backupId:a,backupTenancy:(i||(i=d("I64"))).of_int32(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:g,recoveryCode:o})},"readwrite",void 0,void 0,f.id+":274"),function(a){a=a[0];if(!(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").SUCCESS))){d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Add Device Failure");c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{instanceKey:t});r();e("add_device_error_add_device_sproc_failure");return s("Add device sproc failed")}c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_sproc_success")})}else{d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Add Device Failure");c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND,{instanceKey:t});r();e("add_device_error_backup_id_not_defined");return s("backupId is not defined")}},function(a){var b="Add device failed. Could not find backup.";c("FBLogger")("labyrinth_web").catching(a).mustfix(b);d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Add Device Failure");c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{annotations:{string:{error_message:a.message}},instanceKey:t});r();e("add_device_error_could_not_read_backup_table");return s(b)})});return k.race([u,a]).then(function(){s=!0})}g["default"]=a}),98);
__d("useMWThreadListLastMessageGlimmerWithoutOnActThreadReady.react",["LSMessagingThreadTypeUtil","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("react-compiler-runtime").c(2),c;b[0]!==a?(c=a!=null&&d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)&&a.snippet==null,b[0]=a,b[1]=c):c=b[1];return c}g["default"]=a}),98);